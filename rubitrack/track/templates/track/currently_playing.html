{% extends "admin/base_site.html" %}
{% load admin_urls %}
 
{% block title %}Now Playing - Tonial{% endblock title %}
  
  {% block content %}

  {% if currentTrack %}

<h2><div class="grey_subtitle">Now Playing: </div></h2>

<div class='now_playing_track' id='currentlyPlayingTrackBlock'>
  <div class="row">
    <div class="track_big_blue" >
       {{ currentTrack.title }}  
    </div>

    <div class="green_flashy">- {{ currentTrack.artist.name }}</div>
    
     <div class="green_flashy">
       
    </div>
     <div class="grey_subtitle">
      Genre: {{ currentTrack.genre.name }}  - {{ currentTrack.bpm|floatformat}} bpm - 
      <a href="{% url 'admin:track_track_change' currentTrack.id %}">Edit track info</a>
    </div>
  </div>
</div>

<hr>
<hr>
<hr>
<br>

<div class="blue_subtitle_small">Playlist History: </div>
<div id="tablePlaylistHistory">
<table id="_appendHere" class="table table-striped table-condensed">
  <tr>
    <th>Track Title</th>
    <th>Artist</th>
    <th>Genre</th>
    <th>BPM</th>
    <th style="text-align: center">Save</th>
    <th>Comment</th>
    <th>Date played</th>
  </tr>
  {% for currentPlay in playlistHistory %}
    <tr>                    


     <td><a href="{% url 'admin:track_track_change' currentPlay.track.id %}">{{ currentPlay.track.title }}</a></td>
     <td>{{ currentPlay.track.artist.name }}</td>
     <td>{{ currentPlay.track.genre.name }}</td>
     <td>{{ currentPlay.track.bpm|floatformat}}</td>
     
     <td>
        
            <a class="addlink" href="/track/add_new_transition/?trackId={{ currentTrack.id }}&destinationId={{ currentPlay.track.id }}">
              <b>Save Transition</b>
            </a>
        
        </td>
     <td>{{ currentPlay.track.comment }}</td>
     <td>{{ currentPlay.date_played }}</td>
  </tr>
  {% endfor %}
</table>
</div>




<hr>
<hr>
<hr>
<br>


      <div class="row"/>
      <div class="submit-row">
        <div class="blue_subtitle_small">Transitions - what to play next?</div>&nbsp;
        <a href="{% url 'admin:track_customtracktransition_change' currentTrack.id %}" target="_blank">
              <input type="submit" value="Edit transition details" name="editTransitionDetails">
        </a>  
      </div>

  <table id="suggestionsManualInput" class="table table-striped table-condensed">
        <tr>                    
         <th>Title</td>
         <th>Artist</td>
         <th>Genre</td>
         <th>Bpm</td>
         <th>Comment</td>
         <th>Type</td>
         <th>Quality</td>
         <th>Delete?</td>
        </tr>

        {% for currentTransition in suggestionsManualInput %}
        <tr>                    
         <td><a href="{% url 'admin:track_track_change' currentTransition.track_destination.id %}">{{ currentTransition.track_destination.title }}</a></td>
         <td>{{ currentTransition.track_destination.artist.name }}</td>
         <td>{{ currentTransition.track_destination.genre.name }}</td>
         <td>{{ currentTransition.track_destination.bpm|floatformat}}</td>   
         <td>{{ currentTransition.comment }}</td>
         <td>{{ currentTransition.transition_type.name }}</td>
         <td>{{ currentTransition.ranking }}</td>
         <td>
           <a class="remove-btn" href="/track/delete_transition/?transitionDeleteId={{ currentTransition.id }}">
              <button type="button" class="btn btn-danger">Delete</button>
            </a>

         </td>
        </tr>
        {% endfor %}
      </table>
      
      <table id="suggestionsAuto" class="table table-striped table-condensed">
      <tr>
        <hr>
        <td colspan=9><h3>Suggestions from our algorithm:</h3></th>
        

      </tr>
        <tr>                    
         <th>Title</td>
         <th>Artist</td>
         <th>Genre</td>
         <th>Bpm</td>
         <th>Suggestion</td>
         <th colspan=2 style="text-align: center">Suggestion Rating?</th>
         <th>Comment</td>
         <th>Last Played</td>
        </tr>

        
       
         <tr>                    
         <td>ll</td>
         <td>ll</td>
         <td>ll</td>
         <td>ll</td>
         <td>Same musical genre</td>
         <td class="good_transition">Good</td>
         <td class="bad_transition">Poor</td>
         <td>ll</td>
         <td>ll</td>
        </tr>
         <tr>                    
         <td>rr</td>
         <td>rr</td>
          <td>rr</td>
          <td>rr</td>
         <td>Remixed by the same artist</td>
         <td class="good_transition">Good</td>
         <td class="bad_transition">Poor</td>
         <td>rr</td>
         <td>rr</td>
        </tr>
         <tr>                    
         <td>rr</td>
         <td>rr</td>
          <td>rr</td>
          <td>rr</td>
         <td>Most played after this one</td>
         <td class="good_transition">Good</td>
         <td class="bad_transition">Poor</td>
         <td>rr</td>
         <td>rr</td>
        </tr>
      </table>
</div>


<script>
    var append_increment = 0;
    setInterval(function() {
       
        $.ajax({
          url: '../get_more_playlist_history_table',
          success: function(data) {
            $('#tablePlaylistHistory').html(data); 
          }
        });
        $.ajax({
          url: '../get_more_currently_playing_title_block',
          success: function(data) {
            $('#currentlyPlayingTitleBlock').html(data); 
          }
        });
        $.ajax({
          url: '../get_more_currently_playing_track_block',
          success: function(data) {
            $('#currentlyPlayingTrackBlock').html(data);
             //$('#currentlyPlayingTrackBlock_second').html(data);             
          }
        });

    }, 10000);

    //asynchron action click on rating GOOD/POOR
    function add_new_transition(track_source_id, track_destination_id, transition_rating) {
        $.get('../add_new_transition/'+track_source_id+'/'+track_destination_id+'/'+transition_rating+'/', function (data) {
            alert("New transition saved!");
        });
    }

   

</script>


{% else %}

<div class='now_playing_track' id='currentlyPlayingTrackBlock'>
  <div class="row">
    <div class="track_big_blue" > Please start playing a track </div>
    <div class="green_flashy">- Broadcasto your Mix to http://193.70.86.101/</div> 
    <div class="track_big_blue" >- Port 8059</div>
  </div>
</div>

<script>
  setInterval(function() {
       location.reload();
    }, 10000);
</script>

{% endif %}



 {% endblock content %}

 